---
import Layout from "../layouts/Layout.astro";
---
<script>
document.addEventListener("DOMContentLoaded", () => {
  const toggleBtns = document.querySelectorAll(".toggle-password") as NodeListOf<HTMLButtonElement>;
  toggleBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      const input = btn.previousElementSibling as HTMLInputElement | null;
      if (!input) return;
      if (input.type === "password") {
        input.type = "text";
        btn.textContent = "üôà";
      } else {
        input.type = "password";
        btn.textContent = "üëÅÔ∏è"; 
      }
    });
  });

  const form = document.querySelector("form") as HTMLFormElement | null;
  form?.addEventListener("submit", async (e) => {
    e.preventDefault();

    const formData = new FormData(form as HTMLFormElement);
    const res = await fetch("/api/register", {
      method: "POST",
      body: formData
    });

    const data = await res.json();

    if (data.success) {
      // Redirigir al index
      window.location.href = "/";
    } else {
      alert(data.message);
    }
  });
});
</script>

<Layout title="Registrarse">
  <main class="container">
    <h1 class="titulo">Crear Cuenta</h1>

    <form class="form-box">
      <div class="input-group">
        <label for="username">Usuario:</label>
        <div class="input-with-icon">
          <span class="icon">üë§</span>
          <input type="text" id="username" name="username" placeholder="Tu nombre de usuario" required />
        </div>
      </div>

      <div class="input-group">
        <label for="email">Correo electr√≥nico:</label>
        <div class="input-with-icon">
          <span class="icon">üìß</span>
          <input type="email" id="email" name="email" placeholder="tucorreo@email.com" required />
        </div>
      </div>

      <div class="input-group">
        <label for="password">Contrase√±a:</label>
        <div class="input-with-icon">
          <span class="icon">üîí</span>
          <input type="password" id="password" name="password" placeholder="M√≠nimo 6 caracteres" required />
          <button type="button" class="toggle-password">üëÅÔ∏è</button>
        </div>
      </div>

      <div class="input-group">
        <label for="confirm">Confirmar contrase√±a:</label>
        <div class="input-with-icon">
          <span class="icon">‚úîÔ∏è</span>
          <input type="password" id="confirm" name="confirm" placeholder="Repite tu contrase√±a" required />
          <button type="button" class="toggle-password">üëÅÔ∏è</button>
        </div>
      </div>

      <button type="submit" class="btn">Registrarme</button>
    </form>

    <p class="texto-login">
      ¬øYa tienes una cuenta? <a href="/login" class="link">Inicia sesi√≥n aqu√≠</a>
    </p>
  </main>

<style>
    .container {
        max-width: 420px;
        margin: 0 auto;
        padding: 2rem;
        text-align: center;
        animation: fadeIn 0.4s ease;
    }

    .titulo {
        font-size: 2rem;
        font-weight: 700;
        color: #ffffff;
    }

    .form-box {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        background: rgba(255,255,255,0.05);
        padding: 2rem;
        border-radius: 12px;
        margin-top: 1.5rem;
        backdrop-filter: blur(6px);
        border: 1px solid rgba(255,255,255,0.1);
    }

    label {
        font-size: 0.95rem;
        text-align: left;
        color: #dcdcdc;
        font-weight: 600;
    }

    .input-group {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
    }

    .input-with-icon {
        display: flex;
        align-items: center;
        background: #1a1a1a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 8px 10px;
        transition: border 0.2s;
    }

    .input-with-icon:hover {
        border-color: #0070f3;
    }

    .icon {
        margin-right: 8px;
        font-size: 1.2rem;
        opacity: 0.85;
    }

    input {
        width: 100%;
        background: transparent;
        border: none;
        outline: none;
        color: #fff;
        font-size: 1rem;
    }

    ::placeholder {
        color: #aaa;
    }

    .btn {
        background: linear-gradient(135deg, #0065d1, #0087ff);
        color: white;
        padding: 12px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 600;
        transition: transform 0.15s, opacity 0.2s;
    }

    .btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
    }

    .btn:active {
        transform: scale(0.97);
    }

    .texto-login {
        margin-top: 1.5rem;
        font-size: 0.95rem;
        color: #ccc;
    }

    .link {
        color: #4da8ff;
        font-weight: bold;
        text-decoration: none;
    }

    .link:hover {
        text-decoration: underline;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>
</Layout>
