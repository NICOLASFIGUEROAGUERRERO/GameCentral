---
import FavoritosIcon from "public/favoritos.svg";
import LoginIcon from "public/login.svg";
import LogoVG from "public/logovg.svg";

// Usar la sesión desde el middleware
const user = Astro.locals.user;
---

<header class="w-full bg-yellow-600 text-black py-4 shadow relative">
  <nav class="container mx-auto px-4 grid grid-cols-3 items-center">

    <!-- IZQUIERDA: Nombre -->
    <div class="flex items-center">
      <h1 class="text-xl font-bold">GameCentral</h1>
    </div>

    <!-- CENTRO: Logo clickeable -->
    <div class="flex flex-col items-center justify-center">
      <a href="/">
        <LogoVG class="w-12 h-12" />
      </a>
    </div>

    <!-- DERECHA -->
    <div class="flex justify-end items-center gap-6 text-lg relative">

      <!-- Favoritos -->
      <a href="/favorites" class="hover:text-yellow-400 flex items-center">
        <FavoritosIcon class="w-6 h-6" />
      </a>

      <!-- ICONO DE USUARIO → abre menú -->
      <button id="userMenuBtn" class="hover:text-yellow-400 flex items-center relative">
        <LoginIcon class="w-6 h-6 cursor-pointer" />
      </button>

      <!-- MENÚ DESPLEGABLE -->
      <div 
        id="userMenu" 
        class="hidden absolute right-0 top-12 bg-white text-black rounded-lg shadow-lg w-40 py-2 z-50 animate-fade"
      >
        {user ? (
          <>
            <span class="block px-4 py-2 text-gray-700">Hola, {user.username}</span>

            <form method="POST" action="/api/logout">
              <button 
                type="submit" 
                class="block w-full text-left px-4 py-2 hover:bg-yellow-100"
              >
                Cerrar sesión
              </button>
            </form>
          </>
        ) : (
          <>
            <a href="/login" class="block px-4 py-2 hover:bg-yellow-100">Iniciar sesión</a>
            <a href="/register" class="block px-4 py-2 hover:bg-yellow-100">Registrarse</a>
          </>
        )}
      </div>

    </div>

  </nav>
</header>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("userMenuBtn");
    const menu = document.getElementById("userMenu");

    if (!btn || !menu) return;

    btn.addEventListener("click", () => {
        menu.classList.toggle("hidden");
    });

    document.addEventListener("click", (e) => {
        const target = e.target;
        if (target instanceof Node && !btn.contains(target) && !menu.contains(target)) {
            menu.classList.add("hidden");
        }
    });
});
</script>

<style>
.animate-fade {
    animation: fadeIn 0.15s ease-out;
}
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-6px); }
    to { opacity: 1; transform: translateY(0); }
}
</style>
